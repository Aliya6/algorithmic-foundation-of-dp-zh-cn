# 四、带相关误差的线性查询

隐私数据分析中最基本的原语之一就是能够回答对数据集的数值查询。在上一章中，我们开始看到可以通过向查询答案中添加独立的噪声来实现此目的的工具。 在本章中，我们将继续进行这项研究，并发现通过添加相关的噪声的方法代替以前添加独立噪声的方法，我们可以获得更高精确度回答更为大量查询的能力。在这里，我们看到了解决此问题的两种特定机制，我们将在下一节中对其进行概括。

在本节中，我们考虑的算法比简单使用拉普拉斯机制合成的算法能更精确地解决查询发布问题。这种改进是可能的，因为查询集是作为一个整体来处理的（即使在在线设置中也是如此），所以允许将各个查询的噪音关联起来。要立即发现符合这些思路的某些内容，请考虑第1章中描述的差异攻击中的一对查询。“**数据库中有多少人具有镰状细胞特征？**”和“**除了 X 以外，数据库中有多少人具有镰状细胞特征？**” 假设有一种机制使用拉普拉斯机制回答了第一个问题，然后在提出第二个问题时回答“您已经知道了近似答案，因为您刚刚问过我几乎相似的问题。”对这两个问题的协调响应不会比单独执行任何一个问题所引起的隐私损失更多，因此节省了（少量）隐私。

查询发布问题是很自然的：给定一类查询通过数据库 $\mathcal{Q}$，我们希望为每个查询 $f_i \in \mathcal{Q}$ 发布一些答案 $a_i$ ，使得误差 $\max_i|a_i-f_i(x)|$ 尽可能小，而仍然保留着差分隐私 $\ ^[1]$。回想一下，对于任何低敏感性查询，我们可以应用拉普拉斯机制向这些查询的每个答案添加不同的，独立的噪声。不幸的是，在固定的隐私级别上，比如 $(\varepsilon,0)$-隐私保证，我们必须向答案添加一定大小的噪声，这些噪声是由尺度参数为 $|\mathcal{Q}|$ 的拉普拉斯机制产生的。添加这样大小的噪声是因为这是组合查询的敏感度可能增长的速率。同样，对于 $(\varepsilon,\delta)$ 隐私保证来说，噪声尺度参数为 $\sqrt{|\mathcal{Q}|\ln(1/\delta)}$。例如，假设我们的查询类别 $\mathcal{Q}$ 仅包含同一查询的许多副本：$f_i=f^*$。如果我们使用拉普拉斯机制来释放答案，它将添加独立的噪声，因此每个 $a_i$ 将是均值为 $f^*(x)$ 的独立随机变量。显然，在这种情况下，噪声速率必须以 $|\mathcal{Q}|$ 增长。因为否则 $a_i$ 的平均值将收敛到真实值 $f^*(x)$，这将违反隐私要求的。但是，在这种情况下，因为对于所有 $i$ 来说 $f_i = f^*$，所以仅对 $f^*$ 近似一次（$a^* \approx f^*(X)$），并为所有 $i$ 释放 $a_i=a^*$ 更有意义。在这种情况下，噪声尺度将不必再按 $|\mathcal{Q}|$ 。在本章中，我们旨在通过添加非独立噪声作为查询集的函数来设计比 **Laplace** 机制更精确的算法（误差范围为 $\log |\mathcal{Q}|$）。

（**原文注[1]** 正是隐私限制使问题变得有趣。如果没有这个约束，查询发布问题只需为每个查询输出精确的答案，就可以轻松而优化地解决。）

回想一下，我们的数据全体是 $\mathcal{X}=\{\chi_1,\chi_2,...,\chi_{|\mathcal{X}|}\}$，数据库用 $\mathbb{N}^{|\mathcal{X}|}$ 直方图表示。线性查询类似于计数查询，但归一化为取区间 $[0,1]$ 中的值，而不仅仅是布尔值。具体地说，线性查询 $f$ 采用 $f:\mathcal{X}\to[0,1]$ 的形式，并应用于数据库 $x$，返回数据库上查询的总和或平均值（我们将考虑两者，具体取决于哪个更便于分析）。当我们认为线性查询是返回平均值时，我们将它们称为规范化线性查询，并且其函数值为：
$$
f(x) = \frac{1}{||x||_1}\sum_{i=1}^{|\mathcal{X}|}x_i\cdot f(\chi_i)
$$

当我们认为线性查询返回求和值时，我们将它们称为非规范化的线性查询，并且其函数值为：

$$
f(x)=\sum_{i=1}^{|\mathcal{X}|}x_i\cdot f(\chi_i)
$$

【**补充：** 该部分约定的符号所代表的含义可以参考[2.3节](/2-Basic-Terms/Formalizing-differential-privacy_1.html)。】